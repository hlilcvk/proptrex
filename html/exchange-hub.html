<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROPTREX ‚Äî Exchange Hub</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body,#root{height:100%;overflow:hidden}
body{background:#03060b;color:#c0d8ee;font-family:'JetBrains Mono',monospace;font-size:12px}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:#03060b}::-webkit-scrollbar-thumb{background:#1a2e4a;border-radius:3px}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
.fade-in{animation:fadeIn .3s ease both}
.tooltip-wrap{position:relative;display:inline-flex}
.tooltip-wrap:hover .tooltip-box{display:block}
.tooltip-box{display:none;position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:#1a2e4a;color:#eaf2ff;padding:5px 10px;border-radius:4px;font-size:10px;white-space:nowrap;z-index:999;pointer-events:none;box-shadow:0 4px 12px rgba(0,0,0,.5)}
.tooltip-box::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:#1a2e4a}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:1000;display:flex;align-items:center;justify-content:center}
.modal-box{background:#0a1422;border:1px solid #1a2e4a;border-radius:10px;width:90vw;max-width:1100px;height:75vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.6)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel" data-presets="react">
const {useState,useEffect,useRef,useCallback,useMemo}=React;
const C={cyan:"#00e5ff",green:"#00ff88",red:"#ff2d55",yellow:"#fbbf24",orange:"#ff8c00",purple:"#a855f7",white:"#eaf2ff",txt:"#c0d8ee",txt2:"#7a9cb8",muted:"#3a6080"};

// ‚ïê‚ïê‚ïê LANGUAGE ‚ïê‚ïê‚ïê
const LANG={
  tr:{spot:"SPOT",futures:"FUTURES",all:"HEPSƒ∞",defi:"DEFƒ∞",alerts:"UYARILAR",search:"Coin ara...",symbol:"SEMBOL",type:"Tƒ∞P",exchange:"BORSA",price:"Fƒ∞YAT",change24:"24s%",volume:"HACƒ∞M",mcap:"MCAP",rsi:"RSI",fund:"FUND",score:"DIP SCORE",signal:"Sƒ∞NYAL",trade:"ƒ∞≈ûLEM",noData:"Veri bulunamadƒ±",loading:"API'lerden veri √ßekiliyor...",fgLabel:"KORKU & A√á.",filterAll:"Hepsi",filterStrong:"G√º√ßl√º Al",filterBuy:"Al",filterWatch:"ƒ∞zle",tvVol:"Y√ºksek Hacim",tvGain:"Y√ºkselenler",tvOversold:"A≈üƒ±rƒ± Satƒ±m",tvDip:"Dip Fƒ±rsatƒ±",tvWhale:"Balina Takip",chainTvl:"Zincir TVL Daƒüƒ±lƒ±mƒ±",trendTokens:"Trend Tokenlar",liveAlerts:"Canlƒ± Uyarƒ±lar",last:"Son tarama",platform:"Platform",lang:"EN",close:"Kapat",chart:"Grafik",openEx:"Borsada A√ß",tvChart:"TradingView'da A√ß"},
  en:{spot:"SPOT",futures:"FUTURES",all:"ALL",defi:"DEFI",alerts:"ALERTS",search:"Search coin...",symbol:"SYMBOL",type:"TYPE",exchange:"EXCHANGE",price:"PRICE",change24:"24h%",volume:"VOLUME",mcap:"MCAP",rsi:"RSI",fund:"FUND",score:"DIP SCORE",signal:"SIGNAL",trade:"TRADE",noData:"No data found",loading:"Fetching from APIs...",fgLabel:"FEAR & GREED",filterAll:"All",filterStrong:"Strong Buy",filterBuy:"Buy",filterWatch:"Watch",tvVol:"High Volume",tvGain:"Gainers",tvOversold:"Oversold",tvDip:"Dip Hunter",tvWhale:"Whale Track",chainTvl:"Chain TVL Distribution",trendTokens:"Trending Tokens",liveAlerts:"Live Alerts",last:"Last scan",platform:"Platform",lang:"TR",close:"Close",chart:"Chart",openEx:"Open in Exchange",tvChart:"Open in TradingView"}
};

const fP=n=>{if(!n||isNaN(n))return"‚Äî";const v=Math.abs(n);if(v<1e-5)return"$"+n.toExponential(2);if(v<.01)return"$"+n.toFixed(6);if(v<1)return"$"+n.toFixed(4);if(v<1e3)return"$"+n.toFixed(2);return"$"+n.toLocaleString("tr-TR",{maximumFractionDigits:2})};
const fU=n=>{if(!n)return"‚Äî";const v=Math.abs(n);if(v>=1e12)return"$"+(n/1e12).toFixed(2)+"T";if(v>=1e9)return"$"+(n/1e9).toFixed(2)+"B";if(v>=1e6)return"$"+(n/1e6).toFixed(1)+"M";if(v>=1e3)return"$"+(n/1e3).toFixed(0)+"K";return"$"+n.toFixed(0)};
const fC=n=>n==null||isNaN(n)?"‚Äî":(n>0?"+":"")+Number(n).toFixed(2)+"%";
const pC=n=>(n??0)>0?C.green:(n??0)<0?C.red:C.muted;

const EX={
  binance:{id:"binance",n:"Binance",c:"#f3ba2f",l:s=>`https://www.binance.com/tr/trade/${s}_USDT`},
  bybit:{id:"bybit",n:"Bybit",c:"#f7a600",l:s=>`https://www.bybit.com/trade/usdt/${s}USDT`},
  okx:{id:"okx",n:"OKX",c:"#fff",l:s=>`https://www.okx.com/trade-spot/${s.toLowerCase()}-usdt`},
  gateio:{id:"gateio",n:"Gate.io",c:"#2354e6",l:s=>`https://www.gate.io/trade/${s}_USDT`},
  mexc:{id:"mexc",n:"MEXC",c:"#2a85ff",l:s=>`https://www.mexc.com/tr-TR/exchange/${s}_USDT`},
  bitget:{id:"bitget",n:"Bitget",c:"#00f0ff",l:s=>`https://www.bitget.com/spot/${s}USDT`},
};
const EXL=Object.values(EX);

// ‚ïê‚ïê‚ïê API FETCHERS (CORS-safe) ‚ïê‚ïê‚ïê
const api=async(url,opt)=>{try{const r=await fetch(url,opt);if(!r.ok)throw r.status;return r.json()}catch(e){return null}};
// CORS proxy fallback for blocked APIs
const apiProxy=async(url)=>{
  let d=await api(url);
  if(d)return d;
  try{const r=await fetch("https://api.allorigins.win/raw?url="+encodeURIComponent(url));if(r.ok)return r.json()}catch{}
  return null;
};

async function fetchBinanceSpot(){const d=await api("https://api.binance.com/api/v3/ticker/24hr");return(d||[]).filter(t=>t.symbol.endsWith("USDT")&&+t.quoteVolume>50000).map(t=>({sym:t.symbol.replace("USDT",""),ex:"binance",type:"SPOT",price:+t.lastPrice,ch:+t.priceChangePercent,vol:+t.quoteVolume,hi:+t.highPrice,lo:+t.lowPrice,trades:+t.count}))}
async function fetchBinanceFut(){const d=await api("https://fapi.binance.com/fapi/v1/ticker/24hr");return(d||[]).filter(t=>t.symbol.endsWith("USDT")&&+t.quoteVolume>100000).map(t=>({sym:t.symbol.replace("USDT",""),ex:"binance",type:"FUTURES",price:+t.lastPrice,ch:+t.priceChangePercent,vol:+t.quoteVolume,hi:+t.highPrice,lo:+t.lowPrice}))}
async function fetchFunding(){const d=await api("https://fapi.binance.com/fapi/v1/premiumIndex");const m={};(d||[]).filter(t=>t.symbol.endsWith("USDT")).forEach(t=>m[t.symbol.replace("USDT","")]={fr:+t.lastFundingRate*100,mp:+t.markPrice});return m}
async function fetchBybit(){const d=await api("https://api.bybit.com/v5/market/tickers?category=spot");return(d?.result?.list||[]).filter(t=>t.symbol.endsWith("USDT")&&+t.turnover24h>50000).map(t=>({sym:t.symbol.replace("USDT",""),ex:"bybit",type:"SPOT",price:+t.lastPrice,ch:+t.price24hPcnt*100,vol:+t.turnover24h,hi:+t.highPrice24h,lo:+t.lowPrice24h}))}
async function fetchOKX(){const d=await api("https://www.okx.com/api/v5/market/tickers?instType=SPOT");return(d?.data||[]).filter(t=>t.instId.endsWith("-USDT")&&+t.volCcy24h>50000).map(t=>({sym:t.instId.replace("-USDT",""),ex:"okx",type:"SPOT",price:+t.last,ch:((+t.last-+t.open24h)/+t.open24h)*100,vol:+t.volCcy24h,hi:+t.high24h,lo:+t.low24h}))}
async function fetchGate(){const d=await apiProxy("https://api.gateio.ws/api/v4/spot/tickers");return(d||[]).filter(t=>t.currency_pair?.endsWith("_USDT")&&+t.quote_volume>50000).map(t=>({sym:t.currency_pair.replace("_USDT",""),ex:"gateio",type:"SPOT",price:+t.last,ch:+t.change_percentage,vol:+t.quote_volume,hi:+t.high_24h,lo:+t.low_24h}))}
async function fetchMEXC(){const d=await apiProxy("https://api.mexc.com/api/v3/ticker/24hr");return(d||[]).filter(t=>t.symbol?.endsWith("USDT")&&+t.quoteVolume>50000).map(t=>({sym:t.symbol.replace("USDT",""),ex:"mexc",type:"SPOT",price:+t.lastPrice,ch:+t.priceChangePercent,vol:+t.quoteVolume,hi:+t.highPrice,lo:+t.lowPrice}))}
async function fetchCG(){return await api("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&sparkline=false&price_change_percentage=1h,24h,7d")}
async function fetchFG(){const d=await api("https://api.alternative.me/fng/?limit=1");return d?.data?.[0]||null}
async function fetchDL(){return await api("https://api.llama.fi/v2/chains")}
async function fetchDS(){return await api("https://api.dexscreener.com/token-boosts/top/v1")}
async function fetchTV(f="volume"){
  const fs={volume:[{left:"volume",operation:"greater",right:500000}],gainers:[{left:"change",operation:"greater",right:5},{left:"volume",operation:"greater",right:100000}],oversold:[{left:"RSI",operation:"less",right:35},{left:"volume",operation:"greater",right:100000}],dip:[{left:"change",operation:"less",right:-5},{left:"RSI",operation:"in_range",right:[25,45]}],whale:[{left:"volume",operation:"greater",right:5e6}]};
  const d=await api("https://scanner.tradingview.com/crypto/scan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:fs[f]||fs.volume,options:{lang:"tr"},markets:["crypto"],symbols:{query:{types:[]},tickers:[]},columns:["name","description","close","change","change_abs","volume","market_cap_calc","Recommend.All","RSI","RSI[1]","MACD.macd","MACD.signal","EMA20","EMA50","EMA200","Volatility.D","average_volume_10d_calc","exchange"],sort:{sortBy:"volume",sortOrder:"desc"},range:[0,200]})});
  const cols=["name","desc","close","change","chAbs","vol","mcap","rec","rsi","rsi1","macdM","macdS","ema20","ema50","ema200","volD","avgVol","exchange"];
  return(d?.data||[]).map(i=>{const o={_id:i.s};(i.d||[]).forEach((v,j)=>o[cols[j]]=v);return o})
}

function calcScore(t){
  let s=0;const sig=[];const risk=[];
  const rsi=t.rsi??50,ch=t.ch??0,rec=t.rec??0,vol=t.vol??0,avg=t.avgVol??1,p=t.price??0;
  const vr=avg>0?vol/avg:0;
  if(vr>5){s+=30;sig.push("üöÄ Hacim x"+vr.toFixed(1))}else if(vr>2){s+=15;sig.push("üìà Hacim x"+vr.toFixed(1))}
  if(rsi<30){s+=25;sig.push("‚ö° RSI:"+rsi.toFixed(0))}else if(rsi<40){s+=12;sig.push("üìâ RSI:"+rsi.toFixed(0))}else if(rsi>70){risk.push("‚ö†Ô∏è RSI:"+rsi.toFixed(0));s-=10}
  if(t.ema20&&t.ema50&&p>t.ema20&&t.ema20>t.ema50){s+=15;sig.push("üü¢ EMA‚Üë")}
  if(rec>0.5){s+=20;sig.push("üìä TV AL")}else if(rec<-0.3){risk.push("üìä TV SAT");s-=10}
  if(ch>5&&ch<25){s+=10;sig.push("‚¨ÜÔ∏è+"+ch.toFixed(1)+"%")}
  if(ch<-5&&rsi<40){s+=20;sig.push("üéØ Dip")}
  if(t.fr!=null&&t.fr<-0.01){s+=10;sig.push("üí∞ Fund:"+t.fr.toFixed(3)+"%")}
  s=Math.max(0,Math.min(s,100));
  const lv=s>=70?"G√ú√áL√ú AL":s>=45?"AL":s>=25?"ƒ∞ZLE":"BEKLE";
  return{score:s,level:lv,sig,risk}
}

// ‚ïê‚ïê‚ïê COMPONENTS ‚ïê‚ïê‚ïê
const Badge=({id})=>{const e=EX[id];if(!e)return null;return<span style={{fontSize:"9px",padding:"2px 7px",background:e.c+"18",border:"1px solid "+e.c+"44",color:e.c,borderRadius:"4px",fontWeight:"bold"}}>{e.n}</span>};
const SBar=({s,l})=>{const c=l==="G√ú√áL√ú AL"?C.green:l==="AL"?"#7fff00":l==="ƒ∞ZLE"?C.yellow:C.muted;return<span style={{display:"inline-flex",alignItems:"center",gap:"4px"}}><span style={{width:"50px",height:"5px",background:"#091c2c",borderRadius:"3px",overflow:"hidden",display:"inline-block"}}><span style={{display:"block",height:"100%",width:s+"%",background:c,borderRadius:"3px"}}/></span><span style={{color:c,fontSize:"10px",fontWeight:"bold"}}>{s}</span></span>};
const LPill=({l})=>{const m={"G√ú√áL√ú AL":C.green,"AL":"#7fff00","ƒ∞ZLE":C.yellow,"BEKLE":C.muted};const c=m[l]||C.muted;return<span style={{background:c+"18",border:"1px solid "+c+"44",color:c,borderRadius:"4px",padding:"2px 8px",fontSize:"9px",fontWeight:"bold"}}>{l||"‚Äî"}</span>};
const TPill=({t})=>{const c=t==="SPOT"?C.cyan:C.purple;return<span style={{background:c+"15",border:"1px solid "+c+"33",color:c,borderRadius:"3px",padding:"1px 6px",fontSize:"8px",fontWeight:"bold"}}>{t}</span>};
const Tip=({text,children})=><div className="tooltip-wrap">{children}<div className="tooltip-box">{text}</div></div>;

// ‚ïê‚ïê‚ïê CHART MODAL ‚ïê‚ïê‚ïê
const ChartModal=({sym,onClose,L})=>{
  if(!sym)return null;
  const tvSym="BINANCE:"+sym+"USDT";
  return<div className="modal-overlay" onClick={onClose}><div className="modal-box" onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #1a2e4a",gap:"10px"}}>
      <span style={{fontFamily:"Oxanium",fontWeight:800,fontSize:"16px",color:C.white}}>{sym}/USDT</span>
      <span style={{fontSize:"10px",color:C.txt2}}>{L.chart}</span>
      <div style={{marginLeft:"auto",display:"flex",gap:"6px"}}>
        <a href={`https://tr.tradingview.com/chart/?symbol=${tvSym}`} target="_blank" rel="noopener noreferrer" style={{background:"#1e88e518",border:"1px solid #1e88e544",color:"#1e88e5",borderRadius:"4px",padding:"4px 12px",fontSize:"10px",fontWeight:700,textDecoration:"none"}}>{L.tvChart} ‚Üó</a>
        <button onClick={onClose} style={{background:C.red+"22",border:"1px solid "+C.red+"44",color:C.red,borderRadius:"4px",padding:"4px 14px",fontSize:"10px",fontWeight:700,cursor:"pointer"}}>‚úï {L.close}</button>
      </div>
    </div>
    <iframe src={`https://s.tradingview.com/widgetembed/?frameElementId=tv&symbol=${tvSym}&interval=60&hidesidetoolbar=0&symboledit=1&saveimage=1&toolbarbg=0a1422&studies=%5B%5D&theme=dark&style=1&timezone=Europe%2FIstanbul&withdateranges=1&showpopupbutton=1&studies_overrides=%7B%7D&overrides=%7B%7D&enabled_features=%5B%5D&disabled_features=%5B%5D&locale=tr&utm_source=proptrex`}
      style={{flex:1,border:"none",width:"100%"}} allowFullScreen/>
  </div></div>;
};

// ‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê
function App(){
  const[lang,setLang]=useState("tr");
  const L=LANG[lang];
  const[view,setView]=useState("spot");
  const[raw,setRaw]=useState({bs:[],bf:[],by:[],ok:[],ga:[],mx:[],tv:[],fund:{}});
  const[cg,setCg]=useState([]);
  const[fg,setFg]=useState(null);
  const[chains,setChains]=useState([]);
  const[dex,setDex]=useState([]);
  const[busy,setBusy]=useState(false);
  const[search,setSearch]=useState("");
  const[sortC,setSortC]=useState("vol");
  const[sortD,setSortD]=useState("desc");
  const[exF,setExF]=useState(new Set(EXL.map(e=>e.id)));
  const[sigF,setSigF]=useState("ALL");
  const[tvF,setTvF]=useState("volume");
  const[last,setLast]=useState(null);
  const[clk,setClk]=useState("");
  const[sel,setSel]=useState(null);
  const[chartSym,setChartSym]=useState(null);
  const[st,setSt]=useState({});
  const[alerts,setAlerts]=useState([]);
  const seen=useRef(new Set());

  useEffect(()=>{const t=setInterval(()=>setClk(new Date().toUTCString().match(/(\d\d:\d\d:\d\d)/)?.[1]||""),1000);return()=>clearInterval(t)},[]);

  const load=useCallback(async()=>{
    setBusy(true);const s={};
    const r=await Promise.allSettled([
      fetchBinanceSpot().then(d=>{s.BinSpot=d.length;return["bs",d]}),
      fetchBinanceFut().then(d=>{s.BinFut=d.length;return["bf",d]}),
      fetchFunding().then(d=>{s.Fund=Object.keys(d).length;return["fund",d]}),
      fetchBybit().then(d=>{s.Bybit=d.length;return["by",d]}),
      fetchOKX().then(d=>{s.OKX=d.length;return["ok",d]}),
      fetchGate().then(d=>{s.Gate=d.length;return["ga",d]}),
      fetchMEXC().then(d=>{s.MEXC=d.length;return["mx",d]}),
      fetchTV(tvF).then(d=>{s.TV=d.length;return["tv",d]}),
    ]);
    const n={bs:[],bf:[],by:[],ok:[],ga:[],mx:[],tv:[],fund:{}};
    r.forEach(x=>{if(x.status==="fulfilled"&&x.value){const[k,v]=x.value;n[k]=v}});
    setRaw(n);setSt(s);setLast(new Date());setBusy(false);
  },[tvF]);

  const loadExtra=useCallback(async()=>{
    const[a,b,c,d]=await Promise.allSettled([fetchCG(),fetchFG(),fetchDL(),fetchDS()]);
    if(a.status==="fulfilled"&&a.value)setCg(a.value);
    if(b.status==="fulfilled")setFg(b.value);
    if(c.status==="fulfilled"&&c.value)setChains(c.value.sort((a,b)=>(b.tvl||0)-(a.tvl||0)).slice(0,25));
    if(d.status==="fulfilled"&&Array.isArray(d.value))setDex(d.value.slice(0,25));
  },[]);

  useEffect(()=>{load();loadExtra();const t=setInterval(load,15000);const t2=setInterval(loadExtra,60000);return()=>{clearInterval(t);clearInterval(t2)}},[load,loadExtra]);

  const merged=useMemo(()=>{
    const all=[];const fm=raw.fund||{};const cgm={};(cg||[]).forEach(c=>cgm[c.symbol?.toUpperCase()]=c);
    (raw.tv||[]).forEach(t=>{
      const sym=(t.name||"").split(":").pop()?.replace(/USDT|USD/g,"")||"";
      const exS=(t.exchange||t.name?.split(":")?.[0]||"").toUpperCase();
      let eid="binance";if(exS.includes("BYBIT"))eid="bybit";else if(exS.includes("OKX"))eid="okx";else if(exS.includes("GATE"))eid="gateio";else if(exS.includes("MEXC"))eid="mexc";
      const g=cgm[sym.toUpperCase()];const f=fm[sym];
      const o={sym,ex:eid,type:t.name?.includes("PERP")?"FUTURES":"SPOT",price:t.close,ch:t.change,vol:t.vol,mcap:t.mcap||(g?.market_cap),rsi:t.rsi,ema20:t.ema20,ema50:t.ema50,rec:t.rec,avgVol:t.avgVol,fr:f?.fr,desc:t.desc||(g?.name),src:"TV",_id:"tv_"+t._id,img:g?.image,rank:g?.market_cap_rank,ch1h:g?.price_change_percentage_1h_in_currency,ch7d:g?.price_change_percentage_7d_in_currency};
      o._a=calcScore(o);all.push(o);
    });
    const addCex=arr=>arr.forEach(t=>{
      const k=t.sym+"_"+t.ex+"_"+t.type;if(all.find(a=>a._id===k))return;
      const g=cgm[t.sym.toUpperCase()];const f=fm[t.sym];
      const o={...t,mcap:g?.market_cap,desc:g?.name,fr:f?.fr,img:g?.image,rank:g?.market_cap_rank,ch1h:g?.price_change_percentage_1h_in_currency,ch7d:g?.price_change_percentage_7d_in_currency,_id:k,rsi:null,ema20:null,ema50:null,rec:null,avgVol:null,src:"CEX"};
      o._a=calcScore(o);all.push(o);
    });
    addCex(raw.bs);addCex(raw.bf);addCex(raw.by);addCex(raw.ok);addCex(raw.ga);addCex(raw.mx);
    all.filter(t=>t._a.level==="G√ú√áL√ú AL").forEach(t=>{
      const k=t._id+"_"+Math.floor(Date.now()/180000);
      if(!seen.current.has(k)){seen.current.add(k);setAlerts(p=>[{id:k,ts:new Date(),...t},...p].slice(0,80))}
    });
    return all;
  },[raw,cg]);

  const filtered=useMemo(()=>{
    let d=[...merged];
    if(view==="spot")d=d.filter(t=>t.type==="SPOT");else if(view==="futures")d=d.filter(t=>t.type==="FUTURES");
    if(exF.size<EXL.length)d=d.filter(t=>exF.has(t.ex));
    if(sigF!=="ALL")d=d.filter(t=>t._a.level===sigF);
    if(search){const s=search.toUpperCase();d=d.filter(t=>(t.sym||"").toUpperCase().includes(s)||(t.desc||"").toUpperCase().includes(s))}
    const m=new Map();d.forEach(t=>{const k=t.sym+"_"+t.type;if(!m.has(k)||t.src==="TV")m.set(k,t)});d=Array.from(m.values());
    d.sort((a,b)=>{let va,vb;switch(sortC){case"sym":return sortD==="asc"?(a.sym||"").localeCompare(b.sym):(b.sym||"").localeCompare(a.sym);case"price":va=a.price||0;vb=b.price||0;break;case"ch":va=a.ch||0;vb=b.ch||0;break;case"vol":va=a.vol||0;vb=b.vol||0;break;case"mcap":va=a.mcap||0;vb=b.mcap||0;break;case"rsi":va=a.rsi||50;vb=b.rsi||50;break;case"score":va=a._a.score;vb=b._a.score;break;case"fr":va=Math.abs(a.fr||0);vb=Math.abs(b.fr||0);break;default:va=a.vol||0;vb=b.vol||0}return sortD==="asc"?va-vb:vb-va});
    return d;
  },[merged,view,exF,sigF,search,sortC,sortD]);

  const sC=merged.filter(t=>t.type==="SPOT").length,fC2=merged.filter(t=>t.type==="FUTURES").length;
  const hs=c=>{if(sortC===c)setSortD(d=>d==="asc"?"desc":"asc");else{setSortC(c);setSortD("desc")}};
  const si=c=>sortC===c?(sortD==="asc"?" ‚Üë":" ‚Üì"):"";
  const th={padding:"7px 10px",textAlign:"left",fontSize:"9px",fontWeight:700,color:C.txt2,letterSpacing:".5px",textTransform:"uppercase",borderBottom:"1px solid #12203a",position:"sticky",top:0,background:"#050a14",cursor:"pointer",userSelect:"none",whiteSpace:"nowrap"};
  const td={padding:"6px 10px",borderBottom:"1px solid #080e1a",fontSize:"12px",whiteSpace:"nowrap"};

  return<div style={{display:"flex",flexDirection:"column",height:"100vh"}}>
    {/* CHART MODAL */}
    {chartSym&&<ChartModal sym={chartSym} onClose={()=>setChartSym(null)} L={L}/>}

    {/* HEADER */}
    <div style={{display:"flex",alignItems:"center",gap:"12px",padding:"0 16px",height:"48px",background:"rgba(3,6,11,.95)",borderBottom:"1px solid #12203a",flexShrink:0}}>
      <a href="/" style={{display:"flex",alignItems:"center",gap:"8px",textDecoration:"none"}}>
        <div style={{width:"28px",height:"28px",background:"linear-gradient(135deg,#00e5ff,#a855f7)",clipPath:"polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"9px",fontWeight:800,color:"#000",fontFamily:"Oxanium"}}>PX</div>
        <span style={{fontFamily:"Oxanium",fontSize:"15px",fontWeight:800,color:C.white,letterSpacing:"2px"}}>PROP<span style={{color:C.cyan}}>TREX</span></span>
      </a>
      <span style={{fontSize:"10px",color:C.muted,letterSpacing:"1px",fontWeight:700}}>EXCHANGE HUB</span>
      {fg&&<div style={{background:"#060c16",border:"1px solid #12203a",borderRadius:"5px",padding:"5px 12px",display:"flex",alignItems:"center",gap:"8px"}}>
        <span style={{fontSize:"8px",color:C.txt2}}>{L.fgLabel}</span>
        <span style={{fontSize:"18px",fontWeight:800,color:+fg.value<=25?C.red:+fg.value<=50?C.orange:+fg.value<=75?C.yellow:C.green,fontFamily:"Oxanium"}}>{fg.value}</span>
        <span style={{fontSize:"9px",color:C.txt2}}>{fg.value_classification}</span>
      </div>}
      <div style={{marginLeft:"auto",display:"flex",alignItems:"center",gap:"10px"}}>
        {busy&&<span style={{color:C.cyan,fontSize:"10px",animation:"pulse 1s infinite"}}>‚ü≥</span>}
        <span style={{fontSize:"10px",color:C.txt2}}>UTC {clk}</span>
        <a href="/platform" style={{fontSize:"10px",color:C.cyan,textDecoration:"none",fontWeight:700}}>‚ö° {L.platform}</a>
        <button onClick={()=>setLang(l=>l==="tr"?"en":"tr")} style={{background:C.purple+"22",border:"1px solid "+C.purple+"44",color:C.purple,borderRadius:"4px",padding:"3px 10px",fontSize:"10px",fontWeight:700,cursor:"pointer",fontFamily:"inherit"}}>{L.lang}</button>
      </div>
    </div>

    {/* TABS */}
    <div style={{display:"flex",gap:"1px",padding:"0 16px",background:"#050a14",borderBottom:"1px solid #12203a",flexShrink:0}}>
      {[["spot",L.spot,sC,C.cyan],["futures",L.futures,fC2,C.purple],["all",L.all,merged.length,C.green],["defi",L.defi,chains.length,C.orange],["alerts",L.alerts,alerts.length,C.red]].map(([k,l,n,c])=>
        <span key={k} style={{padding:"8px 16px",fontSize:"11px",fontWeight:700,fontFamily:"Oxanium",color:view===k?C.cyan:C.txt2,background:view===k?"#0a1422":"transparent",borderBottom:view===k?"2px solid "+C.cyan:"2px solid transparent",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"}} onClick={()=>setView(k)}>
          <span style={{color:c,fontSize:"8px"}}>‚óè</span>{l}<span style={{fontSize:"9px",color:C.muted}}>({n})</span>
        </span>)}
    </div>

    {/* API STATUS */}
    <div style={{display:"flex",gap:"6px",padding:"5px 16px",background:"#050a14",borderBottom:"1px solid #0a1422",fontSize:"8px",flexWrap:"wrap",alignItems:"center",flexShrink:0}}>
      {Object.entries(st).map(([k,v])=><span key={k} style={{background:(v>0?C.green:C.red)+"15",border:"1px solid "+(v>0?C.green:C.red)+"33",color:v>0?C.green:C.red,padding:"2px 8px",borderRadius:"3px",fontWeight:700}}>{v>0?"‚úì":"‚úó"} {k}:{v||0}</span>)}
      {last&&<span style={{marginLeft:"auto",color:C.muted}}>{L.last}: {last.toLocaleTimeString(lang==="tr"?"tr-TR":"en-US")}</span>}
    </div>

    {/* SEARCH + FILTERS */}
    <div style={{display:"flex",gap:"6px",padding:"6px 16px",background:"#050a14",borderBottom:"1px solid #0a1422",alignItems:"center",flexShrink:0,flexWrap:"wrap"}}>
      <span style={{color:C.muted,fontSize:"14px"}}>üîç</span>
      <input style={{flex:1,maxWidth:"260px",background:"#080e1a",border:"1px solid #1a2e4a",color:C.txt,borderRadius:"5px",padding:"6px 12px",fontSize:"12px",fontFamily:"inherit",outline:"none"}} placeholder={L.search} value={search} onChange={e=>setSearch(e.target.value)}/>
      {/* Signal filters with tooltips */}
      {[["ALL",L.filterAll,"üîò"],["G√ú√áL√ú AL",L.filterStrong,"üü¢"],["AL",L.filterBuy,"üü°"],["ƒ∞ZLE",L.filterWatch,"‚ö°"]].map(([v,tip,icon])=>
        <Tip key={v} text={tip}><span style={{padding:"4px 10px",fontSize:"10px",fontWeight:700,background:sigF===v?C.cyan+"18":"transparent",border:"1px solid "+(sigF===v?C.cyan+"66":"#12203a"),color:sigF===v?C.cyan:C.txt2,borderRadius:"4px",cursor:"pointer"}} onClick={()=>setSigF(v)}>{icon} {tip}</span></Tip>)}
      <span style={{width:"1px",height:"18px",background:"#12203a"}}/>
      {/* TV filter presets with tooltips */}
      {[["volume","üìä",L.tvVol],["gainers","üìà",L.tvGain],["oversold","‚ö°",L.tvOversold],["dip","üéØ",L.tvDip],["whale","üêã",L.tvWhale]].map(([v,icon,tip])=>
        <Tip key={v} text={tip}><span style={{padding:"4px 8px",fontSize:"10px",background:tvF===v?C.yellow+"18":"transparent",border:"1px solid "+(tvF===v?C.yellow+"66":"#12203a"),color:tvF===v?C.yellow:C.muted,borderRadius:"4px",cursor:"pointer"}} onClick={()=>setTvF(v)}>{icon} {tip}</span></Tip>)}
      <span style={{width:"1px",height:"18px",background:"#12203a"}}/>
      {/* Exchange chips */}
      {EXL.map(e=>{const a=exF.has(e.id);return<Tip key={e.id} text={e.n}><span style={{padding:"3px 8px",fontSize:"9px",fontWeight:700,background:a?e.c+"18":"transparent",border:"1px solid "+(a?e.c+"55":"#0a1422"),color:a?e.c:C.muted,borderRadius:"4px",cursor:"pointer"}} onClick={()=>{const s=new Set(exF);s.has(e.id)?s.delete(e.id):s.add(e.id);setExF(s)}}>{e.n}</span></Tip>})}
    </div>

    {/* CONTENT */}
    {view!=="defi"&&view!=="alerts"?<div style={{flex:1,overflow:"auto"}}>
      <table style={{width:"100%",borderCollapse:"collapse"}}><thead><tr>
        <th style={{...th,width:"32px"}}>#</th>
        <th style={th} onClick={()=>hs("sym")}>{L.symbol}{si("sym")}</th>
        <th style={th}>{L.type}</th><th style={th}>{L.exchange}</th>
        <th style={th} onClick={()=>hs("price")}>{L.price}{si("price")}</th>
        <th style={th} onClick={()=>hs("ch")}>{L.change24}{si("ch")}</th>
        <th style={th} onClick={()=>hs("vol")}>{L.volume}{si("vol")}</th>
        <th style={th} onClick={()=>hs("mcap")}>{L.mcap}{si("mcap")}</th>
        <th style={th} onClick={()=>hs("rsi")}>{L.rsi}{si("rsi")}</th>
        <th style={th} onClick={()=>hs("fr")}>{L.fund}{si("fr")}</th>
        <th style={th} onClick={()=>hs("score")}>{L.score}{si("score")}</th>
        <th style={th}>{L.signal}</th><th style={th}>{L.trade}</th>
      </tr></thead><tbody>
        {filtered.length===0&&<tr><td colSpan={13} style={{...td,textAlign:"center",color:C.muted,padding:"50px",fontSize:"13px"}}>{busy?L.loading:L.noData}</td></tr>}
        {filtered.slice(0,500).map((d,i)=>{const ex=EX[d.ex];const s=sel===d._id;
          return<tr key={d._id} style={{background:s?"#0a1a2e":"transparent",cursor:"pointer"}} onClick={()=>{setSel(s?null:d._id);setChartSym(d.sym)}}
            onMouseEnter={e=>e.currentTarget.style.background="#0a1422"} onMouseLeave={e=>e.currentTarget.style.background=s?"#0a1a2e":"transparent"}>
            <td style={{...td,color:C.muted,fontSize:"10px"}}>{i+1}</td>
            <td style={td}><div style={{display:"flex",alignItems:"center",gap:"6px"}}>
              {d.img&&<img src={d.img} width="18" height="18" style={{borderRadius:"50%"}}/>}
              <span style={{fontWeight:700,color:C.white,fontSize:"13px"}}>{d.sym}</span>
              {d.desc&&<span style={{fontSize:"10px",color:C.txt2}}>{(d.desc||"").slice(0,18)}</span>}
              {d.rank&&<span style={{fontSize:"8px",color:C.muted}}>#{d.rank}</span>}
            </div></td>
            <td style={td}><TPill t={d.type}/></td>
            <td style={td}><Badge id={d.ex}/></td>
            <td style={{...td,fontWeight:700,color:C.white,fontSize:"13px"}}>{fP(d.price)}</td>
            <td style={{...td,fontWeight:700,color:pC(d.ch),fontSize:"12px"}}>{fC(d.ch)}</td>
            <td style={{...td,color:C.txt2}}>{fU(d.vol)}</td>
            <td style={{...td,color:C.txt2}}>{fU(d.mcap)}</td>
            <td style={td}>{d.rsi!=null?<span style={{fontWeight:700,fontSize:"12px",color:d.rsi<30?C.green:d.rsi>70?C.red:C.txt2}}>{d.rsi.toFixed(0)}</span>:<span style={{color:C.muted}}>‚Äî</span>}</td>
            <td style={td}>{d.fr!=null?<span style={{fontWeight:700,color:d.fr<0?C.green:d.fr>0.03?C.red:C.txt2}}>{d.fr.toFixed(3)}%</span>:<span style={{color:C.muted}}>‚Äî</span>}</td>
            <td style={td}><SBar s={d._a.score} l={d._a.level}/></td>
            <td style={td}><LPill l={d._a.level}/></td>
            <td style={td}><div style={{display:"flex",gap:"3px"}}>
              {ex&&<a href={ex.l(d.sym)} target="_blank" rel="noopener noreferrer" style={{background:C.cyan+"12",border:"1px solid "+C.cyan+"33",color:C.cyan,borderRadius:"4px",padding:"3px 8px",fontSize:"9px",fontWeight:700,textDecoration:"none"}} onClick={e=>e.stopPropagation()}>{L.openEx} ‚Üó</a>}
              <span style={{background:C.yellow+"12",border:"1px solid "+C.yellow+"33",color:C.yellow,borderRadius:"4px",padding:"3px 8px",fontSize:"9px",fontWeight:700,cursor:"pointer"}} onClick={e=>{e.stopPropagation();setChartSym(d.sym)}}>üìà {L.chart}</span>
            </div></td>
          </tr>})}
      </tbody></table>
    </div>:view==="defi"?<div style={{flex:1,overflow:"auto",padding:"14px 16px"}}>
      <div style={{background:"#060c16",border:"1px solid #12203a",borderRadius:"8px",padding:"14px",marginBottom:"14px"}}>
        <div style={{fontSize:"10px",color:C.txt2,letterSpacing:"1px",marginBottom:"8px",fontWeight:700}}>üîó {L.chainTvl} ‚Äî DefiLlama</div>
        {chains.slice(0,15).map((ch,i)=>{const mx=chains[0]?.tvl||1;return<div key={ch.name} style={{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"}}>
          <span style={{fontSize:"10px",color:C.txt2,width:"20px"}}>{i+1}</span>
          <span style={{fontSize:"11px",color:C.white,width:"80px",fontWeight:700}}>{ch.name}</span>
          <div style={{flex:1,height:"10px",background:"#091c2c",borderRadius:"3px",overflow:"hidden"}}><div style={{width:(ch.tvl/mx*100)+"%",height:"100%",background:"linear-gradient(90deg,#00e5ff,#a855f7)",borderRadius:"3px"}}/></div>
          <span style={{fontSize:"10px",color:C.cyan,minWidth:"70px",textAlign:"right",fontWeight:700}}>{fU(ch.tvl)}</span>
        </div>})}
      </div>
      <div style={{background:"#060c16",border:"1px solid #12203a",borderRadius:"8px",padding:"14px"}}>
        <div style={{fontSize:"10px",color:C.txt2,letterSpacing:"1px",marginBottom:"8px",fontWeight:700}}>üî• {L.trendTokens} ‚Äî DexScreener</div>
        <div style={{display:"flex",gap:"8px",flexWrap:"wrap"}}>{dex.map((t,i)=><div key={i} style={{background:"#080e1a",border:"1px solid #12203a",borderRadius:"6px",padding:"8px 12px",fontSize:"10px",minWidth:"130px"}}>
          <div style={{fontWeight:700,color:C.white}}>{t.tokenAddress?.slice(0,8)}‚Ä¶</div>
          <div style={{color:C.txt2,fontSize:"9px"}}>{t.chainId} ¬∑ boost:{t.amount}</div>
          {t.url&&<a href={t.url} target="_blank" rel="noopener noreferrer" style={{color:C.cyan,fontSize:"9px",textDecoration:"none"}}>‚Üó</a>}
        </div>)}</div>
      </div>
    </div>:<div style={{flex:1,overflow:"auto",padding:"14px 16px"}}>
      <div style={{fontSize:"13px",fontWeight:700,color:C.cyan,marginBottom:"10px",fontFamily:"Oxanium"}}>üö® {L.liveAlerts} ({alerts.length})</div>
      {alerts.map(a=><div key={a.id} className="fade-in" style={{background:"#080e1a",border:"1px solid #1a2e4a",borderRadius:"6px",padding:"8px 12px",marginBottom:"4px",display:"flex",gap:"10px",alignItems:"center"}}>
        <span style={{fontSize:"16px"}}>üöÄ</span>
        <div style={{flex:1}}><div style={{display:"flex",gap:"6px",alignItems:"center",marginBottom:"2px"}}><span style={{fontWeight:800,color:C.white,fontSize:"13px"}}>{a.sym}</span><Badge id={a.ex}/><LPill l={a._a?.level}/><SBar s={a._a?.score} l={a._a?.level}/></div>
          <div style={{fontSize:"10px",color:C.txt2,display:"flex",gap:"6px",flexWrap:"wrap"}}><span>{fP(a.price)}</span><span style={{color:pC(a.ch)}}>{fC(a.ch)}</span>{a._a?.sig?.map((s,i)=><span key={i} style={{color:C.green}}>{s}</span>)}</div>
        </div><span style={{fontSize:"9px",color:C.muted}}>{a.ts?.toLocaleTimeString(lang==="tr"?"tr-TR":"en-US")}</span>
      </div>)}
    </div>}

    {/* DETAIL BAR */}
    {sel&&view!=="defi"&&view!=="alerts"&&(()=>{const d=filtered.find(x=>x._id===sel);if(!d)return null;const ex=EX[d.ex];
      return<div style={{borderTop:"1px solid #1a2e4a",background:"#060c16",padding:"8px 16px",flexShrink:0,display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap",fontSize:"11px"}}>
        <span style={{fontWeight:800,color:C.white,fontSize:"14px"}}>{d.sym}</span><TPill t={d.type}/><Badge id={d.ex}/>
        <span style={{color:C.white,fontWeight:700,fontSize:"13px"}}>{fP(d.price)}</span><span style={{color:pC(d.ch),fontWeight:700}}>{fC(d.ch)}</span>
        {d.ch1h!=null&&<span style={{color:pC(d.ch1h),fontSize:"10px"}}>1h:{fC(d.ch1h)}</span>}
        {d.ch7d!=null&&<span style={{color:pC(d.ch7d),fontSize:"10px"}}>7d:{fC(d.ch7d)}</span>}
        {d.rsi!=null&&<span style={{color:C.txt2}}>RSI:<span style={{fontWeight:700,color:d.rsi<30?C.green:d.rsi>70?C.red:C.txt}}>{d.rsi.toFixed(1)}</span></span>}
        {d.fr!=null&&<span style={{color:C.txt2}}>Fund:<span style={{fontWeight:700,color:d.fr<0?C.green:C.txt}}>{d.fr.toFixed(4)}%</span></span>}
        <LPill l={d._a.level}/>
        <div style={{display:"flex",gap:"4px",flexWrap:"wrap"}}>{d._a.sig?.map((s,i)=><span key={i} style={{fontSize:"9px",color:C.green,background:C.green+"12",borderRadius:"3px",padding:"2px 6px"}}>{s}</span>)}{d._a.risk?.map((s,i)=><span key={i} style={{fontSize:"9px",color:C.red,background:C.red+"12",borderRadius:"3px",padding:"2px 6px"}}>{s}</span>)}</div>
        <div style={{display:"flex",gap:"4px",marginLeft:"auto"}}>
          {ex&&<a href={ex.l(d.sym)} target="_blank" rel="noopener noreferrer" style={{background:ex.c+"18",border:"1px solid "+ex.c+"44",color:ex.c,borderRadius:"4px",padding:"4px 10px",fontSize:"10px",fontWeight:700,textDecoration:"none"}}>{ex.n} ‚Üó</a>}
          <span style={{background:C.yellow+"18",border:"1px solid "+C.yellow+"44",color:C.yellow,borderRadius:"4px",padding:"4px 10px",fontSize:"10px",fontWeight:700,cursor:"pointer"}} onClick={()=>setChartSym(d.sym)}>üìà {L.chart}</span>
          <a href={"https://tr.tradingview.com/chart/?symbol=BINANCE:"+d.sym+"USDT"} target="_blank" rel="noopener noreferrer" style={{background:"#1e88e518",border:"1px solid #1e88e544",color:"#1e88e5",borderRadius:"4px",padding:"4px 10px",fontSize:"10px",fontWeight:700,textDecoration:"none"}}>TV ‚Üó</a>
        </div>
      </div>})()}

    {/* FOOTER */}
    <div style={{borderTop:"1px solid #080e1a",padding:"4px 16px",display:"flex",gap:"10px",fontSize:"8px",color:"#1a4060",flexWrap:"wrap",flexShrink:0,background:"#030610"}}>
      <span>API: Binance Spot+Futures+Funding ¬∑ Bybit ¬∑ OKX ¬∑ Gate.io ¬∑ MEXC ¬∑ CoinGecko ¬∑ DefiLlama ¬∑ DexScreener ¬∑ TradingView ¬∑ Fear&Greed</span>
      <span style={{color:C.red,opacity:.5}}>‚ö†Ô∏è DYOR</span>
      <span style={{marginLeft:"auto"}}>PROPTREX v3.1</span>
    </div>
  </div>;
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>

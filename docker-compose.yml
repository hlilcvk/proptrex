version: "3.9"

# ═══════════════════════════════════════════════════════════
#  PROPTREX — docker-compose.yml
#  Coolify / Traefik / VPS uyumlu
#  www.proptrex.com
# ═══════════════════════════════════════════════════════════

services:
  proptrex-web:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    image: proptrex/platform:2.0
    container_name: proptrex-web
    restart: unless-stopped

    ports:
      - "${PORT:-8080}:8080"

    environment:
      - TZ=Europe/Istanbul
      - NODE_ENV=production

    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s

    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 128M
        reservations:
          cpus: "0.1"
          memory: 32M

    labels:
      - "com.proptrex.service=web"
      - "com.proptrex.version=2.0.0"
      # ── Traefik SSL (Coolify otomatik yönetir) ──
      # - "traefik.enable=true"
      # - "traefik.http.routers.proptrex.rule=Host(`proptrex.com`) || Host(`www.proptrex.com`)"
      # - "traefik.http.routers.proptrex.entrypoints=websecure"
      # - "traefik.http.routers.proptrex.tls.certresolver=letsencrypt"
      # - "traefik.http.services.proptrex.loadbalancer.server.port=8080"

networks:
  default:
    name: proptrex-net
    driver: bridge
